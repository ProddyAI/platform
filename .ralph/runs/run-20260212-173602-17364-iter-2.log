OpenAI Codex v0.99.0 (research preview)
--------
workdir: /Users/macbook/Documents/GitHub/platform
model: gpt-5.3-codex
provider: openai
approval: never
sandbox: danger-full-access
reasoning effort: medium
reasoning summaries: auto
session id: 019c51c6-0e97-75f3-956f-f48b90b5e8e8
--------
user
# Build

You are an autonomous coding agent. Your task is to complete the work for exactly one story and record the outcome.

## Paths
- PRD: /Users/macbook/Documents/GitHub/platform/.agents/tasks/prd-convex-composio-assistant.json
- AGENTS (optional): /Users/macbook/Documents/GitHub/platform/AGENTS.md
- Progress Log: /Users/macbook/Documents/GitHub/platform/.ralph/progress.md
- Guardrails: /Users/macbook/Documents/GitHub/platform/.ralph/guardrails.md
- Guardrails Reference: /usr/local/lib/node_modules/@iannuttall/ralph/.agents/ralph/references/GUARDRAILS.md
- Context Reference: /usr/local/lib/node_modules/@iannuttall/ralph/.agents/ralph/references/CONTEXT_ENGINEERING.md
- Errors Log: /Users/macbook/Documents/GitHub/platform/.ralph/errors.log
- Activity Log: /Users/macbook/Documents/GitHub/platform/.ralph/activity.log
- Activity Logger: /Users/macbook/Documents/GitHub/platform/ralph log
- No-commit: false
- Repo Root: /Users/macbook/Documents/GitHub/platform
- Run ID: 20260212-173602-17364
- Iteration: 2
- Run Log: /Users/macbook/Documents/GitHub/platform/.ralph/runs/run-20260212-173602-17364-iter-2.log
- Run Summary: /Users/macbook/Documents/GitHub/platform/.ralph/runs/run-20260212-173602-17364-iter-2.md

## Global Quality Gates (apply to every story)
- bun run type
- bun run check
- No secrets in logs or client payloads
- Assistant fallback path must be preserved

## Selected Story (Do not change scope)
ID: S3
Title: Persist tool execution audit trail

Story details:
### S3: Persist tool execution audit trail
Status: in_progress
Depends on: S1

Description:
Persist normalized records for external tool attempts in Convex including actor, tool, arguments snapshot (sanitized), outcome, and timestamp.

Acceptance Criteria:
- [ ] Every external tool attempt writes an audit event
- [ ] Audit payload omits secrets/tokens
- [ ] Audit records are queryable by workspace and member


If the story details are empty or missing, STOP and report that the PRD story format could not be parsed.

## Rules (Non-Negotiable)
- Implement **only** the work required to complete the selected story.
- Complete all tasks associated with this story (and only this story).
- Do NOT ask the user questions.
- Do NOT change unrelated code.
- Do NOT assume something is unimplemented — confirm by reading code.
- Implement completely; no placeholders or stubs.
- If No-commit is true, do NOT commit or push changes.
- Do NOT edit the PRD JSON (status is handled by the loop).
- All changes made during the run must be committed (including updates to progress/logs).
 - Before committing, perform a final **security**, **performance**, and **regression** review of your changes.

## Your Task (Do this in order)
1. Read /Users/macbook/Documents/GitHub/platform/.ralph/guardrails.md before any code changes.
2. Read /Users/macbook/Documents/GitHub/platform/.ralph/errors.log for repeated failures to avoid.
3. Read /Users/macbook/Documents/GitHub/platform/.agents/tasks/prd-convex-composio-assistant.json for global context (do not edit).
4. Fully audit and read all necessary files to understand the task end-to-end before implementing. Do not assume missing functionality.
5. If /Users/macbook/Documents/GitHub/platform/AGENTS.md exists, follow its build/test instructions.
6. Implement only the tasks that belong to S3.
7. Run verification commands listed in the story, the global quality gates, and in /Users/macbook/Documents/GitHub/platform/AGENTS.md (if required).
8. If the project has a build or dev workflow, run what applies:
   - Build step (e.g., `npm run build`) if defined.
   - Dev server (e.g., `npm run dev`, `wrangler dev`) if it is the normal validation path.
   - Confirm no runtime/build errors in the console.
9. Perform a brief audit before committing:
   - **Security:** check for obvious vulnerabilities or unsafe handling introduced by your changes.
   - **Performance:** check for avoidable regressions (extra queries, heavy loops, unnecessary re-renders).
   - **Regression:** verify existing behavior that could be impacted still works.
10. If No-commit is false, commit changes using the `$commit` skill.
    - Stage everything: `git add -A`
    - Confirm a clean working tree after commit: `git status --porcelain` should be empty.
    - After committing, capture the commit hash and subject using:
      `git show -s --format="%h %s" HEAD`.
11. Append a progress entry to /Users/macbook/Documents/GitHub/platform/.ralph/progress.md with run/commit/test details (format below).
    If No-commit is true, skip committing and note it in the progress entry.

## Progress Entry Format (Append Only)
```
## [Date/Time] - S3: Persist tool execution audit trail
Thread: [codex exec session id if available, otherwise leave blank]
Run: 20260212-173602-17364 (iteration 2)
Run log: /Users/macbook/Documents/GitHub/platform/.ralph/runs/run-20260212-173602-17364-iter-2.log
Run summary: /Users/macbook/Documents/GitHub/platform/.ralph/runs/run-20260212-173602-17364-iter-2.md
- Guardrails reviewed: yes
- No-commit run: false
- Commit: <hash> <subject> (or `none` + reason)
- Post-commit status: `clean` or list remaining files
- Verification:
  - Command: <exact command> -> PASS/FAIL
  - Command: <exact command> -> PASS/FAIL
- Files changed:
  - <file path>
  - <file path>
- What was implemented
- **Learnings for future iterations:**
  - Patterns discovered
  - Gotchas encountered
  - Useful context
---
```

## Completion Signal
Only output the completion signal when the **selected story** is fully complete and verified.
When the selected story is complete, output:
<promise>COMPLETE</promise>

Otherwise, end normally without the signal.

## Additional Guardrails
- When authoring documentation, capture the why (tests + implementation intent).
- If you learn how to run/build/test the project, update /Users/macbook/Documents/GitHub/platform/AGENTS.md briefly (operational only).
- Keep AGENTS operational only; progress notes belong in /Users/macbook/Documents/GitHub/platform/.ralph/progress.md.
- If you hit repeated errors, log them in /Users/macbook/Documents/GitHub/platform/.ralph/errors.log and add a Sign to /Users/macbook/Documents/GitHub/platform/.ralph/guardrails.md using /usr/local/lib/node_modules/@iannuttall/ralph/.agents/ralph/references/GUARDRAILS.md as the template.

## Activity Logging (Required)
Log major actions to /Users/macbook/Documents/GitHub/platform/.ralph/activity.log using the helper:
```
/Users/macbook/Documents/GitHub/platform/ralph log "message"
```
Log at least:
- Start of work on the story
- After major code changes
- After tests/verification
- After updating progress log

## Browser Testing (Required for Frontend Stories)
If the selected story changes UI, you MUST verify it in the browser:
1. Load the `dev-browser` skill.
2. Navigate to the relevant page.
3. Verify the UI changes work as expected.
4. Take a screenshot if helpful for the progress log.

A frontend story is NOT complete until browser verification passes.

mcp startup: no servers
2026-02-12T12:14:20.340006Z ERROR codex_core::rollout::list: state db missing rollout path for thread 019c517b-3db1-7050-a86f-b8a19d243c0a

thinking
**Starting coding with logging**
codex
I’ll complete story `S3` end-to-end: first I’m reading guardrails, prior errors, and the PRD context, then I’ll audit the code paths for external tool execution and implement only the audit-trail persistence required.
exec
/bin/zsh -lc '/Users/macbook/Documents/GitHub/platform/ralph log "Start S3 iteration 2: reviewing guardrails, errors, PRD" && echo logged' in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc 'cat .ralph/guardrails.md' in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc 'cat .agents/tasks/prd-convex-composio-assistant.json' in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc 'cat .ralph/errors.log' in /Users/macbook/Documents/GitHub/platform exited 127 in 51ms:
zsh:1: no such file or directory: /Users/macbook/Documents/GitHub/platform/ralph
 succeeded in 51ms:
# Guardrails (Signs)

> Lessons learned from failures. Read before acting.

## Core Signs

### Sign: Read Before Writing
- **Trigger**: Before modifying any file
- **Instruction**: Read the file first
- **Added after**: Core principle

### Sign: Test Before Commit
- **Trigger**: Before committing changes
- **Instruction**: Run required tests and verify outputs
- **Added after**: Core principle

---

## Learned Signs

 succeeded in 51ms:
# Error Log

> Failures and repeated issues. Use this to add guardrails.

[2026-02-12 17:19:46] ITERATION 1 left uncommitted changes; review run summary at /Users/macbook/Documents/GitHub/platform/.ralph/runs/run-20260212-171007-13768-iter-1.md
[2026-02-12 17:44:17] ITERATION 1 left uncommitted changes; review run summary at /Users/macbook/Documents/GitHub/platform/.ralph/runs/run-20260212-173602-17364-iter-1.md
 succeeded in 51ms:
{
  "document_type": "PRD",
  "version": "1.1",
  "status": "draft",
  "created_at": "2026-02-12",
  "title": "Proddy AI Assistant (Convex + Composio) - Codebase Aligned",
  "slug": "convex-composio-assistant",
  "request_context": "User requested a PRD for an AI assistant based on Convex DB that connects to external tools via Composio, and asked to base it on the current codebase where most parts already exist.",
  "product_summary": "Proddy already includes a Convex-backed AI assistant with conversation persistence, internal workspace tools, and Composio-powered external tool actions. This PRD defines completion criteria to move the existing implementation from feature-rich draft state to reliable production behavior.",
  "current_implementation": {
    "assistant_runtime": {
      "status": "implemented",
      "details": [
        "Conversation lifecycle and streaming are wired through `@dayhaysoos/convex-database-chat`.",
        "Assistant actions are implemented in Convex (`assistantChat.sendMessage`) with OpenAI tool-calling.",
        "Workspace assistant UI is available at `/workspace/[workspaceId]/assistant`."
      ],
      "evidence_files": [
        "convex/assistantChat.ts",
        "convex/assistantConversations.ts",

thinking
**Checking script and instructions**
codex
I found guardrails and PRD context; next I’m auditing the repository for existing audit/event logic and reading `AGENTS.md` for project-specific build/test requirements before editing. Also, the activity logger path failed, so I’ll locate the correct executable and continue logging.
exec
/bin/zsh -lc 'cat AGENTS.md' in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc 'ls -la' in /Users/macbook/Documents/GitHub/platform exited 1 in 51ms:
cat: AGENTS.md: No such file or directory
 succeeded in 51ms:
total 2328
drwxr-xr-x@  34 macbook  staff    1088 Feb 12 17:14 .
drwxr-xr-x@   9 macbook  staff     288 Feb 12 12:45 ..
-rw-r--r--@   1 macbook  staff    8196 Feb  4 09:25 .DS_Store
drwxr-xr-x@   4 macbook  staff     128 Feb 12 17:05 .agents
-rw-r--r--@   1 macbook  staff      88 Jan 23 15:09 .deepsource.toml
-rw-r--r--@   1 macbook  staff     243 Feb  6 19:12 .env.convex.example
-rw-r--r--@   1 macbook  staff    2335 Feb  7 12:25 .env.local
-rw-r--r--@   1 macbook  staff     808 Feb 10 11:13 .env.next.example
drwxr-xr-x@  16 macbook  staff     512 Feb 12 17:44 .git
drwxr-xr-x@   4 macbook  staff     128 Jan 23 15:09 .github
-rw-r--r--@   1 macbook  staff     445 Feb  6 19:12 .gitignore
drwxr-xr-x@  20 macbook  staff     640 Feb 12 17:42 .next
drwxr-xr-x@   8 macbook  staff     256 Feb 12 17:31 .ralph
-rw-r--r--@   1 macbook  staff    3428 Feb  1 13:47 README.md
-rw-r--r--@   1 macbook  staff    2682 Feb 10 18:21 biome.json
-rw-r--r--@   1 macbook  staff  367894 Feb 11 22:09 bun.lock
drwxr-xr-x@   4 macbook  staff     128 Feb 11 13:49 certificates
-rw-r--r--@   1 macbook  staff    2214 Jan 23 15:09 coderabbit.yaml
-rw-r--r--@   1 macbook  staff     391 Jan 23 15:09 components.json
exec
/bin/zsh -lc 'rg -n "audit|tool execution|composio|external tool|assistant" convex src | head -n 200' in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:
convex/chatbotQueries.ts:7:	role: "user" | "assistant";
convex/chatbotQueries.ts:396:		role: v.union(v.literal("user"), v.literal("assistant")),
convex/chatbotQueries.ts:423:			// Persist a single message with the given role (dashboard sends user then assistant separately)
convex/chatbotQueries.ts:481:						role: "assistant",
convex/chatbotQueries.ts:483:							"Hello! I'm your workspace assistant. How can I help you today?",
convex/integrations.ts:181:			v.literal("use_composio_managed_auth"),
convex/integrations.ts:187:		composioAuthConfigId: v.string(),
convex/integrations.ts:202:			composioAuthConfigId: args.composioAuthConfigId,
convex/integrations.ts:354:		composioAccountId: v.string(),
convex/integrations.ts:376:			composioAccountId: args.composioAccountId,
convex/integrations.ts:495:		// Log the deletion for audit purposes
convex/integrations.ts:546:		composioServerId: v.string(),
convex/integrations.ts:563:			composioServerId: args.composioServerId,
convex/assistantConversations.ts:12:			.query("assistantConversations")
convex/assistantConversations.ts:26:			.query("assistantConversations")
convex/assistantConversations.ts:43:			.query("assistantConversations")
convex/assistantConversations.ts:57:		return await ctx.db.insert("assistantConversations", {
convex/assistantConversations.ts:75:			.query("assistantConversations")
src/lib/composio-config.ts:1:import { Composio } from "@composio/core";
src/lib/composio-config.ts:2:import { OpenAIProvider } from "@composio/openai";

thinking
**Identifying logging command source**
codex
I’ve identified likely implementation points in `convex/chatbot.ts` and schema. Next I’m reading those files plus checking how to invoke the activity logger correctly so I can keep required run logs.
exec
/bin/zsh -lc "sed -n '1,260p' convex/schema.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "rg --files | rg '("'^|/)ralph$|activity.log|assistant.*audit|schema.ts|chatbot.ts|assistantComposioTools.ts'"'" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "sed -n '260,620p' convex/schema.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "sed -n '1,260p' convex/chatbot.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "sed -n '260,760p' convex/chatbot.ts" in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:
import { authTables } from "@convex-dev/auth/server";
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

const schema = defineSchema({
	...authTables,
	// Extend the users table with additional profile fields
	users: defineTable({
		name: v.optional(v.string()),
		image: v.optional(v.string()),
		banner: v.optional(v.union(v.string(), v.null())),
		email: v.optional(v.string()),
		emailVerificationTime: v.optional(v.number()),
		phone: v.optional(v.string()),
		phoneVerificationTime: v.optional(v.number()),
		isAnonymous: v.optional(v.boolean()),
		// Additional profile fields
		bio: v.optional(v.string()),
		location: v.optional(v.string()),
		website: v.optional(v.string()),
exec
/bin/zsh -lc "sed -n '1,260p' convex/assistantComposioTools.ts" in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:
src/app/mockup/components/test-dashboard-chatbot.tsx
convex/chatbot.ts
convex/schema.ts
convex/assistantComposioTools.ts
src/features/dashboard/components/dashboard-chatbot.tsx
 succeeded in 51ms:
		.index("by_category_id", ["categoryId"]),

	mentions: defineTable({
		messageId: v.optional(v.id("messages")),
		mentionedMemberId: v.id("members"),
		mentionerMemberId: v.id("members"),
		workspaceId: v.id("workspaces"),
		channelId: v.optional(v.id("channels")),
		conversationId: v.optional(v.id("conversations")),
		parentMessageId: v.optional(v.id("messages")),
		cardId: v.optional(v.id("cards")),
		cardTitle: v.optional(v.string()),
		read: v.boolean(),
		createdAt: v.number(),
	})
		.index("by_workspace_id", ["workspaceId"])
		.index("by_mentioned_member_id", ["mentionedMemberId"])
		.index("by_mentioner_member_id", ["mentionerMemberId"])
		.index("by_message_id", ["messageId"])
		.index("by_card_id", ["cardId"])
 succeeded in 51ms:
"use node";

import { openai } from "@ai-sdk/openai";
import { Composio } from "@composio/core";
import { getAuthUserId } from "@convex-dev/auth/server";
import { generateText } from "ai";
import { v } from "convex/values";
import OpenAI from "openai";
import { api } from "./_generated/api";
import type { Id, TableNames } from "./_generated/dataModel";
import { action } from "./_generated/server";

// Define types for chat messages and responses
type Source = {
	id: string;
	type: string;
	text: string;
};

type ChatMessage = {
 succeeded in 51ms:
		"linear ticket",
		"linear project",
		"issue tracking",
		"linear",
	],
	LINEAD: [
		"create campaign",
		"update campaign",
		"pause campaign",
		"resume campaign",
		"delete campaign",
		"create ad",
		"update ad",
		"ad creative",
		"ad copy",
		"ad headline",
		"audience targeting",
		"job title targeting",
		"company targeting",
		"location targeting",
 succeeded in 51ms:
"use node";

import { Composio } from "@composio/core";
import { v } from "convex/values";
import OpenAI from "openai";
import {
	buildCancellationMessage,
	buildConfirmationRequiredMessage,
	getHighImpactToolNames,
	getUserConfirmationDecision,
} from "../src/lib/high-impact-action-confirmation";
import { api, internal } from "./_generated/api";
import type { Id } from "./_generated/dataModel";
import { action } from "./_generated/server";

async function executeComposioAction(
	ctx: { runQuery: (query: any, args: any) => Promise<any> },
	entityId: string,
	appNames: string[],
	message: string,

thinking
**Holding assistant tools steady**
exec
/bin/zsh -lc "sed -n '260,520p' convex/assistantComposioTools.ts" in /Users/macbook/Documents/GitHub/platform succeeded in 52ms:
	},
	handler: async (ctx, args) => {
		const memberId = await getMemberId(ctx, args.workspaceId, args.userId);
		if (!memberId) {
			return { success: false, error: "Member not found" };
		}
		return await executeComposioAction(
			ctx,
			`member_${memberId}`,
			["CLICKUP"],
			args.instruction,
			args.workspaceId
		);
	},
});

export const runLinearTool = action({
	args: {
		workspaceId: v.id("workspaces"),
		userId: v.id("users"),

thinking
**Inspecting external tool audit points**
codex
I confirmed there are two external-tool execution paths (`convex/chatbot.ts` and `convex/assistantComposioTools.ts`). I’ll now inspect the Next.js chatbot route to verify which path is active and ensure auditing is wired where all attempts flow.
exec
/bin/zsh -lc "sed -n '1,300p' src/app/api/assistant/chatbot/route.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "sed -n '300,680p' src/app/api/assistant/chatbot/route.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc 'rg -n "executeComposioAction|composio.tools.execute|tool_calls|audit|assistantTool|tool attempt" src/app/api/assistant/chatbot/route.ts convex | head -n 200' in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "find . -maxdepth 2 -type f -name 'ralph' -o -name 'ralph*'" in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:
import type { Composio } from "@composio/core";
import {
	convexAuthNextjsToken,
	isAuthenticatedNextjs,
} from "@convex-dev/auth/nextjs/server";
import { ConvexHttpClient } from "convex/browser";
import { type NextRequest, NextResponse } from "next/server";
import OpenAI from "openai";
import { api } from "@/../convex/_generated/api";
import type { Id } from "@/../convex/_generated/dataModel";
import {
	buildAssistantResponseMetadata,
	buildAssistantSystemPrompt,
	classifyAssistantQuery,
} from "@/lib/assistant-orchestration";
import {
	type AvailableApp,
	createComposioClient,
	filterToolsForQuery,
	getAllToolsForApps,
 succeeded in 51ms:
							return NextResponse.json({
								success: true,
								response: buildCancellationMessage(highImpactToolNames),
								sources: [],
								actions: [],
								toolResults: [],
								assistantType: "openai-composio",
								composioToolsUsed: false,
								connectedApps,
								metadata: buildAssistantResponseMetadata({
									assistantType: "openai-composio",
									executionPath: "nextjs-openai-composio",
									intent: queryIntent,
									tools: {
										internalEnabled: true,
										externalEnabled: true,
										externalUsed: false,
										connectedApps,
									},
								}),
 succeeded in 51ms:
src/app/api/assistant/chatbot/route.ts:291:					completion.choices[0]?.message?.tool_calls &&
src/app/api/assistant/chatbot/route.ts:292:					completion.choices[0].message.tool_calls.length > 0
src/app/api/assistant/chatbot/route.ts:294:					const toolCalls = completion.choices[0].message.tool_calls as any[];
convex/schema.ts:196:	// Card activity log for audit trail
convex/integrations.ts:495:		// Log the deletion for audit purposes
convex/chatbot.ts:390:async function executeComposioAction(
convex/chatbot.ts:528:			completion.choices[0]?.message?.tool_calls &&
convex/chatbot.ts:529:			completion.choices[0].message.tool_calls.length > 0
convex/chatbot.ts:531:			for (const toolCall of completion.choices[0].message.tool_calls) {
convex/chatbot.ts:535:						const result = await composio.tools.execute(
convex/chatbot.ts:615:			toolCalls: completion.choices[0]?.message?.tool_calls,
convex/chatbot.ts:619:		console.error("[executeComposioAction] Error:", error);
convex/chatbot.ts:1590:			const composioResult = await executeComposioAction(
convex/_generated/api.d.ts:15:import type * as assistantTools from "../assistantTools.js";
convex/_generated/api.d.ts:63:  assistantTools: typeof assistantTools;
convex/assistantComposioTools.ts:16:async function executeComposioAction(
convex/assistantComposioTools.ts:118:			completion.choices[0]?.message?.tool_calls &&
convex/assistantComposioTools.ts:119:			completion.choices[0].message.tool_calls.length > 0
convex/assistantComposioTools.ts:121:			const toolCalls = completion.choices[0].message.tool_calls;
convex/assistantComposioTools.ts:143:					await composio.tools.execute(toolCall.function.name, {
 succeeded in 51ms:
./.agents/ralph

thinking
**Planning audit logging integration**
codex
I found the activity logger at `./.agents/ralph`; I’ll switch to that command. I’m now checking whether audit helpers already exist and then I’ll implement a dedicated Convex audit table plus writes from both external execution paths.
exec
/bin/zsh -lc './.agents/ralph log "S3: completed codebase audit; implementing Convex tool audit trail"' in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "sed -n '440,620p' convex/integrations.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "sed -n '1,220p' convex/assistantChat.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "sed -n '220,760p' convex/assistantChat.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc 'rg -n "sanitize|redact|secret|token|password|api[_-]?key|tool audit|assistantToolAudit|toolAudit" convex src | head -n 200' in /Users/macbook/Documents/GitHub/platform exited 126 in 50ms:
zsh:1: permission denied: ./.agents/ralph
 succeeded in 51ms:
				`Attempted to delete legacy connected account ${args.connectedAccountId} without memberId. ` +
					"Use adminDeleteConnectedAccount for legacy records."
			);
			throw new Error(
				"Unauthorized: Cannot delete a connected account without an owner. Contact admin."
			);
		}

		if (connectedAccount.memberId !== args.memberId) {
			throw new Error(
				"Unauthorized: Cannot delete another member's connection"
			);
		}

		// Delete the connected account from database
		await ctx.db.delete(args.connectedAccountId);
	},
});

// Admin-only mutation to delete legacy connected accounts without memberId
 succeeded in 51ms:
import { getAuthUserId } from "@convex-dev/auth/server";
import { v } from "convex/values";
import OpenAI from "openai";
import {
	type AssistantExternalApp,
	buildAssistantResponseMetadata,
	buildAssistantSystemPrompt,
	classifyAssistantQuery,
} from "../src/lib/assistant-orchestration";
import { api, components } from "./_generated/api";
import { action, mutation, query } from "./_generated/server";

type ToolHandlerType = "query" | "mutation" | "action";

type ToolDefinition = {
	name: string;
	description: string;
	parameters: {
		type: "object";
		properties: Record<string, { type: string; description?: string }>;
 succeeded in 50ms:
		contextParams: { needsWorkspaceId: true, needsUserId: true },
		externalApp: "GMAIL",
	},
	{
		name: "runSlackTool",
		description:
			"Use Slack to post messages, reply in threads, or get channel info. Provide a clear instruction like 'post in #general that the deploy is done'.",
		parameters: {
			type: "object" as const,
			properties: {
				instruction: {
					type: "string",
					description: "What you want Slack to do",
				},
			},
			required: ["instruction"],
		},
		handlerType: "action" as const,
		handler: api.assistantComposioTools.runSlackTool,
		contextParams: { needsWorkspaceId: true, needsUserId: true },
 succeeded in 51ms:
convex/schema.ts:580:		hash: v.string(), // token from email link
convex/schema.ts:591:		userId: v.optional(v.id("users")), // Optional for unauthenticated rate limiting (e.g., password reset)
convex/schema.ts:598:			v.literal("password_reset") // For password reset rate limiting
convex/schema.ts:609:	// Password reset tokens
convex/schema.ts:610:	passwordResetTokens: defineTable({
convex/schema.ts:612:		token: v.string(), // Hashed token for security
convex/schema.ts:618:		.index("by_token", ["token"])
convex/schema.ts:633:		accessToken: v.string(), // OAuth access token (should be encrypted at rest)
convex/schema.ts:634:		refreshToken: v.optional(v.string()), // Refresh token (should be encrypted at rest)
convex/http.ts:74:			// Exchange code for access token
convex/http.ts:87:			let tokenResponse;
convex/http.ts:89:				tokenResponse = await fetch("https://slack.com/api/oauth.v2.access", {
convex/http.ts:97:						client_secret: clientSecret,
convex/http.ts:104:					throw new Error("OAuth token exchange timeout");
convex/http.ts:111:			const tokenData = await tokenResponse.json();
convex/http.ts:113:			if (!tokenData.ok) {
convex/http.ts:114:				throw new Error(tokenData.error || "Failed to exchange OAuth code");
convex/http.ts:117:			// Validate required token fields
convex/http.ts:119:				!tokenData.access_token ||
convex/http.ts:120:				!tokenData.team ||

thinking
**Inspecting agent executable permissions**
exec
/bin/zsh -lc 'ls -la .agents/ralph && head -n 80 .agents/ralph' in /Users/macbook/Documents/GitHub/platform exited 1 in 52ms:
total 760
drwxr-xr-x@ 11 macbook  staff     352 Feb 12 17:05 .
drwxr-xr-x@  4 macbook  staff     128 Feb 12 17:05 ..
-rw-r--r--@  1 macbook  staff    5190 Feb 12 17:05 PROMPT_build.md
-rw-r--r--@  1 macbook  staff    4907 Feb 12 17:06 README.md
-rw-r--r--@  1 macbook  staff     868 Feb 12 17:05 agents.sh
-rw-r--r--@  1 macbook  staff    1058 Feb 12 17:05 config.sh
-rw-r--r--@  1 macbook  staff    2732 Feb 12 17:06 diagram.svg
-rwxr-xr-x@  1 macbook  staff     353 Feb 12 17:05 log-activity.sh
-rwxr-xr-x@  1 macbook  staff   27605 Feb 12 17:05 loop.sh
-rw-r--r--@  1 macbook  staff  275808 Feb 12 17:06 ralph.webp
drwxr-xr-x@  4 macbook  staff     128 Feb 12 17:05 references
head: Error reading .agents/ralph

thinking
**Planning comprehensive tool audit logging**
codex
I’ve narrowed scope: I’ll add a dedicated Convex audit table plus logging mutations/queries, then wire writes from both tool execution paths (`assistantComposioTools` and Next.js `chatbot` route) with argument sanitization to strip secrets/tokens. I’m checking member lookup helpers next to ensure records are indexed/queryable by workspace and member.
exec
/bin/zsh -lc "sed -n '1,260p' convex/members.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc 'cat package.json' in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc 'rg -n "getCurrentMember|getMemberById|by_workspace_id_user_id|current member" convex/members.ts convex/*.ts | head -n 200' in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "rg -n \"api\\.chatbot|internal\\.chatbot|from \\\"\\.\\/chatbot\\\"|executeComposioAction\\(\" convex src | head -n 200" in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:
import { getAuthUserId } from "@convex-dev/auth/server";
import { v } from "convex/values";

import type { Id } from "./_generated/dataModel";
import {
	internalQuery,
	mutation,
	type QueryCtx,
	query,
} from "./_generated/server";

export const _getMemberById = internalQuery({
	args: {
		id: v.id("members"),
	},
	handler: async (ctx, args) => {
		return await ctx.db.get(args.id);
	},
});

exec
/bin/zsh -lc './.agents/ralph/log-activity.sh "S3: implementing audit table and logging hooks"' in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:
{
	"name": "proddy",
	"version": "1.0.1",
	"private": true,
	"packageManager": "bun@1.3.6",
	"scripts": {
		"next": "next dev --experimental-https",
		"convex": "convex dev",
		"type": "tsc --noEmit",
		"check": "biome check --write . --unsafe",
		"start": "next start",
		"build": "next build"
	},
	"author": {
		"name": "ProddyAI",
		"url": "https://github.com/ProddyAI"
	},
	"description": "Collaborate with your team using real-time messaging in this app built with Next.js, Convex, and Shadcn UI.",
	"keywords": [
		"reactjs",
 succeeded in 52ms:
convex/threadTitles.ts:57:		// Get current member
convex/threadTitles.ts:60:			.withIndex("by_workspace_id_user_id", (q) =>
convex/threadTitles.ts:105:		// Get current member
convex/threadTitles.ts:108:			.withIndex("by_workspace_id_user_id", (q) =>
convex/typing.ts:117:			.withIndex("by_workspace_id_user_id", (q) =>
convex/messages.ts:69:		.withIndex("by_workspace_id_user_id", (q) =>
convex/messages.ts:538:		// Get the current member using the base user ID
convex/messages.ts:541:			.withIndex("by_workspace_id_user_id", (q) =>
convex/messages.ts:553:		// Get all messages for the current member in this workspace
convex/messages.ts:721:		// Get the current member using the base user ID
convex/messages.ts:724:			.withIndex("by_workspace_id_user_id", (q) =>
convex/messages.ts:981:			// Get the current member
convex/messages.ts:984:				.withIndex("by_workspace_id_user_id", (q) =>
convex/notes.ts:27:			.withIndex("by_workspace_id_user_id", (q) =>
convex/notes.ts:77:			.withIndex("by_workspace_id_user_id", (q) =>
convex/notes.ts:112:			.withIndex("by_workspace_id_user_id", (q) =>
convex/notes.ts:153:			.withIndex("by_workspace_id_user_id", (q) =>
convex/notes.ts:187:			.withIndex("by_workspace_id_user_id", (q) =>
convex/notes.ts:234:			.withIndex("by_workspace_id_user_id", (q) =>
convex/notes.ts:303:			.withIndex("by_workspace_id_user_id", (q) =>
 succeeded in 51ms:
convex/chatbot.ts:390:async function executeComposioAction(
convex/chatbot.ts:1539:				const history = await ctx.runQuery(api.chatbotQueries.getChatHistory, {
convex/chatbot.ts:1590:			const composioResult = await executeComposioAction(
convex/chatbot.ts:2126:						api.chatbotQueries.getMyCalendarEventsInRange,
convex/chatbot.ts:2171:						api.chatbotQueries.getMyCalendarEventsInRange,
convex/chatbot.ts:2193:						api.chatbotQueries.getMyCalendarEventsInRange,
convex/chatbot.ts:2217:						ctx.runQuery(api.chatbotQueries.getMyCalendarEventsInRange, {
convex/chatbot.ts:2222:						ctx.runQuery(api.chatbotQueries.getMyCalendarEventsInRange, {
convex/chatbot.ts:2281:						api.chatbotQueries.getMyTasksInRange,
convex/chatbot.ts:2311:						api.chatbotQueries.getMyTasksInRange,
convex/chatbot.ts:2342:						api.chatbotQueries.getMyUpcomingTasks,
convex/chatbot.ts:2374:						ctx.runQuery(api.chatbotQueries.getMyCalendarEventsInRange, {
convex/chatbot.ts:2379:						ctx.runQuery(api.chatbotQueries.getMyTasksInRange, {
convex/chatbot.ts:2385:						ctx.runQuery(api.chatbotQueries.getMyUpcomingTasks, {
convex/chatbot.ts:2461:						ctx.runQuery(api.chatbotQueries.getMyCalendarEventsInRange, {
convex/chatbot.ts:2466:						ctx.runQuery(api.chatbotQueries.getMyTasksInRange, {
convex/chatbot.ts:2472:						ctx.runQuery(api.chatbotQueries.getMyUpcomingTasks, {
convex/chatbot.ts:2750:					ctx.runQuery(api.chatbotQueries.getMyCalendarEventsInRange, {
convex/chatbot.ts:2755:					ctx.runQuery(api.chatbotQueries.getMyTasksInRange, {
convex/chatbot.ts:2761:					ctx.runQuery(api.chatbotQueries.getMyUpcomingTasks, {
 succeeded in 806ms:


thinking
**Designing comprehensive audit logging**
exec
/bin/zsh -lc "sed -n '1520,1665p' convex/chatbot.ts" in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:

	handler: async (
		ctx,
		args
	): Promise<{
		answer: string;
		sources: string[];
		actions?: NavigationAction[];
	}> => {
		const workspaceId = args.workspaceId;
		if (!workspaceId) {
			return {
				answer: "Workspace context is required.",
				sources: [],
			};
		}

		const recentChatMessages = await (async (): Promise<ChatMessage[]> => {
			try {
				const history = await ctx.runQuery(api.chatbotQueries.getChatHistory, {

thinking
**Mapping memberId usage and planning edits**
codex
I’ve completed the audit and identified all external execution points; next I’m editing schema + new `assistantToolAudits` module, then wiring logging calls in the Convex and Next.js execution loops without changing behavior.
exec
/bin/zsh -lc './.agents/ralph/log-activity.sh "S3: starting code edits for audit persistence and sanitization"' in /Users/macbook/Documents/GitHub/platform succeeded in 52ms:


thinking
**Patching schema after assistantConversations**
file update
M /Users/macbook/Documents/GitHub/platform/convex/schema.ts
@@ -480,2 +480,20 @@
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
apply_patch(auto_approved=true) exited 0 in 36ms:
Success. Updated the following files:
M /Users/macbook/Documents/GitHub/platform/convex/schema.ts
file update:
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),

file update:
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),


thinking
**Adding sanitizer utility file**
file update
A /Users/macbook/Documents/GitHub/platform/src/lib/assistant-tool-audit.ts
const REDACTED_VALUE = "[REDACTED]";
const MAX_DEPTH = 6;
const MAX_STRING_LENGTH = 2000;
const SENSITIVE_KEY_PATTERN =
	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;

function sanitizeString(input: string): string {
	return input
		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
		.replace(
			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
			`$1=${REDACTED_VALUE}`
		)
		.slice(0, MAX_STRING_LENGTH);
}

export function sanitizeAuditPayload(
	value: unknown,
	depth = 0,
	parentKey = ""
): unknown {
	if (depth > MAX_DEPTH) {
		return "[TRUNCATED]";
	}

	if (value === null || value === undefined) {
		return value;
	}

	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
		return REDACTED_VALUE;
	}

	if (typeof value === "string") {
		return sanitizeString(value);
	}

	if (
		typeof value === "number" ||
		typeof value === "boolean" ||
		typeof value === "bigint"
	) {
		return value;
	}

	if (Array.isArray(value)) {
		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
	}

	if (typeof value === "object") {
		const entries = Object.entries(value as Record<string, unknown>);
		const sanitized: Record<string, unknown> = {};
		for (const [key, childValue] of entries) {
			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
		}
		return sanitized;
	}

	return String(value).slice(0, MAX_STRING_LENGTH);
}

export function parseAndSanitizeArguments(rawArguments: string): unknown {
	try {
		return sanitizeAuditPayload(JSON.parse(rawArguments));
	} catch {
		return sanitizeAuditPayload(rawArguments);
	}
}
apply_patch(auto_approved=true) exited 0 in 88ms:
Success. Updated the following files:
A /Users/macbook/Documents/GitHub/platform/src/lib/assistant-tool-audit.ts
file update:
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}

file update:
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Adding new convex module**
file update
A /Users/macbook/Documents/GitHub/platform/convex/assistantToolAudits.ts
import { getAuthUserId } from "@convex-dev/auth/server";
import { v } from "convex/values";
import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
import type { Id } from "./_generated/dataModel";
import { internalMutation, mutation, query } from "./_generated/server";

type ToolAuditOutcome = "success" | "error";

async function getCurrentMember(
	ctx: { db: any },
	workspaceId: Id<"workspaces">,
	userId: Id<"users">
) {
	return await ctx.db
		.query("members")
		.withIndex("by_workspace_id_user_id", (q: any) =>
			q.eq("workspaceId", workspaceId).eq("userId", userId)
		)
		.unique();
}

const auditArgs = {
	workspaceId: v.id("workspaces"),
	memberId: v.optional(v.id("members")),
	userId: v.optional(v.id("users")),
	toolName: v.string(),
	toolkit: v.optional(v.string()),
	argumentsSnapshot: v.optional(v.any()),
	outcome: v.union(v.literal("success"), v.literal("error")),
	error: v.optional(v.string()),
	executionPath: v.string(),
	toolCallId: v.optional(v.string()),
	timestamp: v.optional(v.number()),
};

function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
	return value === "error" ? "error" : "success";
}

async function insertAuditEvent(
	ctx: { db: any },
	args: {
		workspaceId: Id<"workspaces">;
		memberId?: Id<"members">;
		userId?: Id<"users">;
		toolName: string;
		toolkit?: string;
		argumentsSnapshot?: unknown;
		outcome: ToolAuditOutcome;
		error?: string;
		executionPath: string;
		toolCallId?: string;
		timestamp?: number;
	}
) {
	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
	const safeError = sanitizeAuditPayload(args.error);

	await ctx.db.insert("assistantToolAuditEvents", {
		workspaceId: args.workspaceId,
		memberId: args.memberId,
		userId: args.userId,
		toolName: args.toolName,
		toolkit: args.toolkit,
		argumentsSnapshot: safeArguments,
		outcome: normalizeOutcome(args.outcome),
		error: typeof safeError === "string" ? safeError : undefined,
		executionPath: args.executionPath,
		toolCallId: args.toolCallId,
		timestamp: args.timestamp ?? Date.now(),
	});
}

export const logExternalToolAttemptInternal = internalMutation({
	args: auditArgs,
	handler: async (ctx, args) => {
		await insertAuditEvent(ctx, args);
	},
});

export const logExternalToolAttempt = mutation({
	args: auditArgs,
	handler: async (ctx, args) => {
		const authUserId = await getAuthUserId(ctx);
		if (!authUserId) {
			throw new Error("Unauthorized");
		}

		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
		if (!member) {
			throw new Error("Unauthorized");
		}

		await insertAuditEvent(ctx, {
			...args,
			userId: args.userId ?? authUserId,
			memberId: args.memberId ?? member._id,
		});
	},
});

export const listByWorkspace = query({
	args: {
		workspaceId: v.id("workspaces"),
		limit: v.optional(v.number()),
	},
	handler: async (ctx, args) => {
		const authUserId = await getAuthUserId(ctx);
		if (!authUserId) {
			return [];
		}

		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
		if (!member) {
			return [];
		}

		return await ctx.db
			.query("assistantToolAuditEvents")
			.withIndex("by_workspace_id_timestamp", (q: any) =>
				q.eq("workspaceId", args.workspaceId)
			)
			.order("desc")
			.take(args.limit ?? 50);
	},
});

export const listByWorkspaceAndMember = query({
	args: {
		workspaceId: v.id("workspaces"),
		memberId: v.id("members"),
		limit: v.optional(v.number()),
	},
	handler: async (ctx, args) => {
		const authUserId = await getAuthUserId(ctx);
		if (!authUserId) {
			return [];
		}

		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
		if (!requester) {
			return [];
		}

		if (
			requester._id !== args.memberId &&
			requester.role !== "owner" &&
			requester.role !== "admin"
		) {
			return [];
		}

		return await ctx.db
			.query("assistantToolAuditEvents")
			.withIndex("by_workspace_id_member_id", (q: any) =>
				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
			)
			.order("desc")
			.take(args.limit ?? 50);
	},
});
apply_patch(auto_approved=true) exited 0 in 101ms:
Success. Updated the following files:
A /Users/macbook/Documents/GitHub/platform/convex/assistantToolAudits.ts
file update:
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}

file update:
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Enforcing explicit typing rules**
codex
I’ve added the schema and audit module. I’m now wiring logging into `convex/assistantComposioTools.ts` so each Composio tool attempt records sanitized args and success/error outcome.
file update
M /Users/macbook/Documents/GitHub/platform/convex/assistantComposioTools.ts
@@ -11,2 +11,3 @@
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
@@ -16,3 +17,6 @@
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
@@ -20,3 +24,5 @@
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
@@ -141,7 +147,68 @@
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
@@ -186,3 +253,5 @@
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
@@ -207,3 +276,5 @@
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
@@ -228,3 +299,5 @@
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
@@ -249,3 +322,5 @@
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
@@ -270,3 +345,5 @@
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
@@ -291,3 +368,5 @@
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
apply_patch(auto_approved=true) exited 0 in 117ms:
Success. Updated the following files:
M /Users/macbook/Documents/GitHub/platform/convex/assistantComposioTools.ts
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}

file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Preparing targeted patch for action execution**
exec
/bin/zsh -lc "sed -n '360,680p' convex/chatbot.ts" in /Users/macbook/Documents/GitHub/platform succeeded in 52ms:
				matchedKeywords.push(keyword);
				score += 100;
			}
		}

		// Check generic Composio keywords for this app
		for (const keyword of GENERIC_COMPOSIO_KEYWORDS) {
			if (lowerQuery.includes(keyword.toLowerCase())) {
				score += 50;
				matchedKeywords.push(keyword);
			}
		}

		if (score > 0 && (!bestMatch || score > bestMatch.confidence)) {
			bestMatch = { app, confidence: score, keywords: matchedKeywords };
		}
	}

	// Return if confidence threshold met (at least 1 keyword match = 100)
	if (bestMatch && bestMatch.confidence >= 100) {
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Inspecting top import statements**
exec
/bin/zsh -lc "sed -n '1,40p' convex/chatbot.ts" in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:
"use node";

import { openai } from "@ai-sdk/openai";
import { Composio } from "@composio/core";
import { getAuthUserId } from "@convex-dev/auth/server";
import { generateText } from "ai";
import { v } from "convex/values";
import OpenAI from "openai";
import { api } from "./_generated/api";
import type { Id, TableNames } from "./_generated/dataModel";
import { action } from "./_generated/server";

// Define types for chat messages and responses
type Source = {
	id: string;
	type: string;
	text: string;
};

type ChatMessage = {
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Adding imports and patching calls**
file update
M /Users/macbook/Documents/GitHub/platform/convex/chatbot.ts
@@ -8,3 +8,4 @@
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
@@ -390,3 +391,6 @@
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
@@ -394,3 +398,4 @@
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
@@ -532,2 +537,5 @@
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
@@ -541,2 +549,15 @@
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
@@ -555,2 +576,16 @@
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
@@ -1594,3 +1629,4 @@
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
apply_patch(auto_approved=true) exited 0 in 118ms:
Success. Updated the following files:
M /Users/macbook/Documents/GitHub/platform/convex/chatbot.ts
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}

file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Adding comprehensive tool audit logging**
file update
M /Users/macbook/Documents/GitHub/platform/src/app/api/assistant/chatbot/route.ts
@@ -29,2 +29,3 @@
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
@@ -60,2 +61,33 @@
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
@@ -85,2 +117,3 @@
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
@@ -142,2 +175,3 @@
 			}
+			authenticatedUserId = currentUser._id;
 
@@ -370,2 +404,31 @@
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? JSON.stringify(toolResult ?? "Tool execution failed")
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
@@ -402,2 +465,24 @@
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
apply_patch(auto_approved=true) exited 0 in 265ms:
Success. Updated the following files:
M /Users/macbook/Documents/GitHub/platform/src/app/api/assistant/chatbot/route.ts
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..9cc15a00b3a0f198be4a75d237cc8b3be2abaf34
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -27,6 +27,7 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
 export const dynamic = "force-dynamic";
 
@@ -58,6 +59,37 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +115,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +173,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +402,35 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? JSON.stringify(toolResult ?? "Tool execution failed")
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +463,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}

file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..9cc15a00b3a0f198be4a75d237cc8b3be2abaf34
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -27,6 +27,7 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
 export const dynamic = "force-dynamic";
 
@@ -58,6 +59,37 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +115,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +173,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +402,35 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? JSON.stringify(toolResult ?? "Tool execution failed")
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +463,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Refining error handling to avoid token exposure**
file update
M /Users/macbook/Documents/GitHub/platform/src/app/api/assistant/chatbot/route.ts
@@ -425,3 +425,7 @@
 										outcome === "error"
-											? JSON.stringify(toolResult ?? "Tool execution failed")
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
 											: undefined,
apply_patch(auto_approved=true) exited 0 in 482ms:
Success. Updated the following files:
M /Users/macbook/Documents/GitHub/platform/src/app/api/assistant/chatbot/route.ts
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..07656440ad2c26e34281903b8310ed15c4c3e92e
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -27,6 +27,7 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
 export const dynamic = "force-dynamic";
 
@@ -58,6 +59,37 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +115,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +173,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +402,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +467,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}

file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..07656440ad2c26e34281903b8310ed15c4c3e92e
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -27,6 +27,7 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
 export const dynamic = "force-dynamic";
 
@@ -58,6 +59,37 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +115,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +173,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +402,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +467,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Planning codegen imports and formatting**
codex
Core code changes are in place across schema, audit module, and both execution paths. Next I’m running codegen plus required verification (`type`, `check`, and build`) and will fix any issues before commit.
exec
/bin/zsh -lc './.agents/ralph/log-activity.sh "S3: major code changes completed; starting verification"' in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc 'npx convex codegen' in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:

 exited 1 in 25.91s:
Finding component definitions...
Generating server code...
Bundling component definitions...
Bundling component schemas and implementations...
Downloading current deployment state...
Uploading functions to Convex...
Generating TypeScript bindings...
Running TypeScript...
✖ TypeScript typecheck via `tsc` failed.
To ignore failing typecheck, use `--typecheck=disable`.
- Collecting TypeScript errors

[96mconvex/assistantComposioTools.ts[0m:[93m179[0m:[93m8[0m - [91merror[0m[90m TS2322: [0mType 'unknown' is not assignable to type 'Record<string, unknown> | undefined'.

[7m179[0m        arguments: actionParams,
[7m   [0m [91m       ~~~~~~~~~[0m

  [96mnode_modules/@composio/core/dist/BaseProvider-C7yGAyLz.d.mts[0m:[93m2892[0m:[93m3[0m
    [7m2892[0m   arguments?: Record<string, unknown> | undefined;
    [7m    [0m [96m  ~~~~~~~~~[0m
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..af3865b0c4986b5df6c79f5105fa654c5248c42d
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,72 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: unknown = sanitizedArgs;
+					try {
+						actionParams = JSON.parse(toolCall.function.arguments);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +251,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +274,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +297,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +320,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +343,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +366,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..07656440ad2c26e34281903b8310ed15c4c3e92e
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -27,6 +27,7 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
 export const dynamic = "force-dynamic";
 
@@ -58,6 +59,37 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +115,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +173,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +402,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +467,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Fixing unknown cast type handling**
file update
M /Users/macbook/Documents/GitHub/platform/convex/assistantComposioTools.ts
@@ -150,5 +150,8 @@
 					);
-					let actionParams: unknown = sanitizedArgs;
+					let actionParams: Record<string, unknown> | undefined = undefined;
 					try {
-						actionParams = JSON.parse(toolCall.function.arguments);
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (parsed && typeof parsed === "object" && !Array.isArray(parsed)) {
+							actionParams = parsed as Record<string, unknown>;
+						}
 					} catch (error) {
apply_patch(auto_approved=true) exited 0 in 162ms:
Success. Updated the following files:
M /Users/macbook/Documents/GitHub/platform/convex/assistantComposioTools.ts
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..dd0f8755228a753852469d50fff785ffe8b839e7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,75 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined = undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (parsed && typeof parsed === "object" && !Array.isArray(parsed)) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +254,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +277,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +300,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +323,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +346,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +369,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..07656440ad2c26e34281903b8310ed15c4c3e92e
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -27,6 +27,7 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
 export const dynamic = "force-dynamic";
 
@@ -58,6 +59,37 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +115,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +173,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +402,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +467,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}

file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..dd0f8755228a753852469d50fff785ffe8b839e7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,75 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined = undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (parsed && typeof parsed === "object" && !Array.isArray(parsed)) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +254,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +277,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +300,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +323,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +346,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +369,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..07656440ad2c26e34281903b8310ed15c4c3e92e
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -27,6 +27,7 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
 export const dynamic = "force-dynamic";
 
@@ -58,6 +59,37 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +115,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +173,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +402,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +467,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Retrying code generation**
codex
I hit a strict type mismatch in Composio execution args and fixed it by narrowing parsed arguments to a record. I’m rerunning codegen and then the required quality gates.
exec
/bin/zsh -lc 'npx convex codegen' in /Users/macbook/Documents/GitHub/platform succeeded in 17.73s:
Finding component definitions...
Generating server code...
Bundling component definitions...
Bundling component schemas and implementations...
Downloading current deployment state...
Uploading functions to Convex...
Generating TypeScript bindings...
Running TypeScript...
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..dd0f8755228a753852469d50fff785ffe8b839e7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,75 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined = undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (parsed && typeof parsed === "object" && !Array.isArray(parsed)) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +254,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +277,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +300,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +323,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +346,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +369,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..07656440ad2c26e34281903b8310ed15c4c3e92e
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -27,6 +27,7 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
 export const dynamic = "force-dynamic";
 
@@ -58,6 +59,37 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +115,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +173,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +402,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +467,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Running sequential verification commands**
exec
/bin/zsh -lc 'bun run type' in /Users/macbook/Documents/GitHub/platformfile update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..dd0f8755228a753852469d50fff785ffe8b839e7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,75 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined = undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (parsed && typeof parsed === "object" && !Array.isArray(parsed)) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +254,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +277,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +300,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +323,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +346,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +369,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..07656440ad2c26e34281903b8310ed15c4c3e92e
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -27,6 +27,7 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
 export const dynamic = "force-dynamic";
 
@@ -58,6 +59,37 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +115,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +173,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +402,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +467,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}

 succeeded in 33.22s:

file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..dd0f8755228a753852469d50fff785ffe8b839e7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -9,16 +9,22 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "../src/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import { api, internal } from "./_generated/api";
 import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,75 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined = undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (parsed && typeof parsed === "object" && !Array.isArray(parsed)) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +254,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +277,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +300,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +323,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +346,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +369,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..07656440ad2c26e34281903b8310ed15c4c3e92e
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -27,6 +27,7 @@
 	getHighImpactToolNames,
 	getUserConfirmationDecision,
 } from "@/lib/high-impact-action-confirmation";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 
 export const dynamic = "force-dynamic";
 
@@ -58,6 +59,37 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(api.assistantToolAudits.logExternalToolAttempt, {
+			workspaceId: params.workspaceId,
+			memberId: params.memberId,
+			userId: params.userId,
+			toolName: params.toolName,
+			toolkit: params.toolkit,
+			argumentsSnapshot: params.argumentsSnapshot,
+			outcome: params.outcome,
+			error: params.error,
+			executionPath: params.executionPath,
+			toolCallId: params.toolCallId,
+		});
+	} catch (error) {
+		console.warn("[Chatbot Assistant] Failed to persist tool audit event", error);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +115,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +173,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +402,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +467,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2ff6fb2d61982a87399c7bf8d26585ccf8a3f643
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,68 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) => sanitizeAuditPayload(item, depth + 1, parentKey));
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Running build checks**
exec
/bin/zsh -lc 'bun run check' in /Users/macbook/Documents/GitHub/platform exited 1 in 872ms:
convex/chatbotQueries.ts:253:57 lint/style/noNonNullAssertion ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ! Forbidden non-null assertion.
  
    251 │ 		);
    252 │ 		const channelMap = new Map(
  > 253 │ 			channels.filter(Boolean).map((c) => [String(c?._id), c!])
        │ 			                                                     ^^
    254 │ 		);
    255 │ 
  

convex/integrations.ts:265:56 lint/style/noNonNullAssertion ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  ! Forbidden non-null assertion.
  
    263 │ 			const connectedAccounts = await ctx.db
    264 │ 				.query("connected_accounts")
  > 265 │ 				.withIndex("by_member_id", (q) => q.eq("memberId", args.memberId!))
        │ 				                                                   ^^^^^^^^^^^^^^
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Inspecting and isolating unrelated fixes**
codex
`bun run check` reports a large set of existing repo-wide lint violations and auto-touched a few files; I’ll keep scope tight by retaining only S3-related changes, then I’ll run `bun run build` and report gate status precisely.
exec
/bin/zsh -lc 'bun run build' in /Users/macbook/Documents/GitHub/platformfile update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Polling for build status**
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}

 succeeded in 1m 27s:
  ▲ Next.js 14.2.35
  - Environments: .env.local

   Creating an optimized production build ...
> [PWA] Compile server
> [PWA] Compile server
> [PWA] Compile client (static)
> [PWA] Custom worker found: /Users/macbook/Documents/GitHub/platform/worker/index.js
> [PWA] Build custom worker: /Users/macbook/Documents/GitHub/platform/public/worker-oA5mCfDPwL0WqzC1xIzTK.js
> [PWA] Auto register service worker with: /Users/macbook/Documents/GitHub/platform/node_modules/next-pwa/register.js
> [PWA] Service worker: /Users/macbook/Documents/GitHub/platform/public/sw.js
> [PWA]   url: /sw.js
> [PWA]   scope: /
 ✓ Compiled successfully
   Skipping linting
   Checking validity of types ...
   Collecting page data ...
   Generating static pages (0/48) ...
   Generating static pages (12/48) 
   Generating static pages (24/48) 
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Inspecting generated file changes**
exec
/bin/zsh -lc 'git status --short' in /Users/macbook/Documents/GitHub/platform succeeded in 50ms:
 M .agents/tasks/prd-convex-composio-assistant.json
 M .ralph/activity.log
 M .ralph/errors.log
 M .ralph/runs/run-20260212-173602-17364-iter-1.log
 M convex/_generated/api.d.ts
 M convex/assistantComposioTools.ts
 M convex/chatbot.ts
 M convex/schema.ts
 M src/app/api/assistant/chatbot/route.ts
 M src/app/pricing/page.tsx
?? .ralph/.tmp/prompt-20260212-173602-17364-2.md
?? .ralph/.tmp/story-20260212-173602-17364-2.json
?? .ralph/.tmp/story-20260212-173602-17364-2.md
?? .ralph/runs/run-20260212-173602-17364-iter-1.md
?? .ralph/runs/run-20260212-173602-17364-iter-2.log
?? convex/assistantToolAudits.ts
?? src/lib/assistant-tool-audit.ts
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Inspecting unrelated file changes**
exec
/bin/zsh -lc "git diff -- src/app/pricing/page.tsx | sed -n '1,200p'" in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:
diff --git a/src/app/pricing/page.tsx b/src/app/pricing/page.tsx
index 7f2f220..fea17c5 100644
--- a/src/app/pricing/page.tsx
+++ b/src/app/pricing/page.tsx
@@ -70,7 +70,7 @@ const PricingPage = () => {
 							<ul className="space-y-3 mb-8">
 								<li className="flex items-start">
 									<Check className="h-5 w-5 text-green-500 mr-2 flex-shrink-0 mt-0.5" />
-									<span className="text-gray-700">Unlimited users</span>
+									<span className="text-gray-700">5 users</span>
 								</li>
 								<li className="flex items-start">
 									<Check className="h-5 w-5 text-green-500 mr-2 flex-shrink-0 mt-0.5" />
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Navigating commit sequencing and staging conflicts**
codex
I’m now validating the exact diff to ensure only S3-related logic is introduced, then I’ll do the required security/performance/regression audit and proceed with commit + progress logging.
exec
/bin/zsh -lc "git diff -- convex/_generated/api.d.ts | sed -n '1,220p'" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "git diff -- convex/schema.ts convex/assistantToolAudits.ts convex/assistantComposioTools.ts convex/chatbot.ts src/app/api/assistant/chatbot/route.ts src/lib/assistant-tool-audit.ts | sed -n '1,260p'" in /Users/macbook/Documents/GitHub/platform succeeded in 50ms:
diff --git a/convex/_generated/api.d.ts b/convex/_generated/api.d.ts
index a56565d..fb12454 100644
--- a/convex/_generated/api.d.ts
+++ b/convex/_generated/api.d.ts
@@ -12,6 +12,7 @@ import type * as analytics from "../analytics.js";
 import type * as assistantChat from "../assistantChat.js";
 import type * as assistantComposioTools from "../assistantComposioTools.js";
 import type * as assistantConversations from "../assistantConversations.js";
+import type * as assistantToolAudits from "../assistantToolAudits.js";
 import type * as assistantTools from "../assistantTools.js";
 import type * as auth from "../auth.js";
 import type * as board from "../board.js";
@@ -60,6 +61,7 @@ declare const fullApi: ApiFromModules<{
   assistantChat: typeof assistantChat;
   assistantComposioTools: typeof assistantComposioTools;
   assistantConversations: typeof assistantConversations;
+  assistantToolAudits: typeof assistantToolAudits;
   assistantTools: typeof assistantTools;
   auth: typeof auth;
   board: typeof board;
 succeeded in 50ms:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407daf..0587238 100644
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@ import type { Id } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Reviewing truncated diff for new files**
exec
/bin/zsh -lc "sed -n '1,260p' convex/assistantToolAudits.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc "sed -n '1,220p' src/lib/assistant-tool-audit.ts" in /Users/macbook/Documents/GitHub/platformexec
/bin/zsh -lc 'rg -n "assistantToolAudits|parseAndSanitizeArguments|assistantToolAuditEvents|logExternalToolAuditEvent" src/app/api/assistant/chatbot/route.ts convex/chatbot.ts convex/assistantComposioTools.ts convex/schema.ts' in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:
import { getAuthUserId } from "@convex-dev/auth/server";
import { v } from "convex/values";
import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
import type { Id } from "./_generated/dataModel";
import { internalMutation, mutation, query } from "./_generated/server";

type ToolAuditOutcome = "success" | "error";

async function getCurrentMember(
	ctx: { db: any },
	workspaceId: Id<"workspaces">,
	userId: Id<"users">
) {
	return await ctx.db
		.query("members")
		.withIndex("by_workspace_id_user_id", (q: any) =>
			q.eq("workspaceId", workspaceId).eq("userId", userId)
		)
		.unique();
}
 succeeded in 52ms:
const REDACTED_VALUE = "[REDACTED]";
const MAX_DEPTH = 6;
const MAX_STRING_LENGTH = 2000;
const SENSITIVE_KEY_PATTERN =
	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;

function sanitizeString(input: string): string {
	return input
		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
		.replace(
			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
			`$1=${REDACTED_VALUE}`
		)
		.slice(0, MAX_STRING_LENGTH);
}

export function sanitizeAuditPayload(
	value: unknown,
	depth = 0,
	parentKey = ""
 succeeded in 50ms:
convex/schema.ts:481:	assistantToolAuditEvents: defineTable({
convex/assistantComposioTools.ts:6:import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
convex/assistantComposioTools.ts:148:					const sanitizedArgs = parseAndSanitizeArguments(
convex/assistantComposioTools.ts:163:							internal.assistantToolAudits.logExternalToolAttemptInternal,
convex/assistantComposioTools.ts:189:							internal.assistantToolAudits.logExternalToolAttemptInternal,
convex/assistantComposioTools.ts:204:							internal.assistantToolAudits.logExternalToolAttemptInternal,
src/app/api/assistant/chatbot/route.ts:16:import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
src/app/api/assistant/chatbot/route.ts:62:async function logExternalToolAuditEvent(params: {
src/app/api/assistant/chatbot/route.ts:77:			api.assistantToolAudits.logExternalToolAttempt,
src/app/api/assistant/chatbot/route.ts:419:								await logExternalToolAuditEvent({
src/app/api/assistant/chatbot/route.ts:426:									argumentsSnapshot: parseAndSanitizeArguments(
src/app/api/assistant/chatbot/route.ts:478:								await logExternalToolAuditEvent({
src/app/api/assistant/chatbot/route.ts:485:									argumentsSnapshot: parseAndSanitizeArguments(
convex/chatbot.ts:9:import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
convex/chatbot.ts:538:					const sanitizedArgs = parseAndSanitizeArguments(
convex/chatbot.ts:551:							internal.assistantToolAudits.logExternalToolAttemptInternal,
convex/chatbot.ts:578:							internal.assistantToolAudits.logExternalToolAttemptInternal,
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Planning two-step commit process**
exec
/bin/zsh -lc './.agents/ralph/log-activity.sh "S3: verification complete (type pass, check fail on existing repo lint, build pass)"' in /Users/macbook/Documents/GitHub/platform succeeded in 52ms:

file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Committing all changes including logs**
codex
I’m proceeding to commit the implementation changes now using a conventional commit message, then I’ll append the required progress entry and commit that log update.
exec
/bin/zsh -lc 'git status --short' in /Users/macbook/Documents/GitHub/platform succeeded in 50ms:
 M .agents/tasks/prd-convex-composio-assistant.json
 M .ralph/activity.log
 M .ralph/errors.log
 M .ralph/runs/run-20260212-173602-17364-iter-1.log
 M convex/_generated/api.d.ts
 M convex/assistantComposioTools.ts
 M convex/chatbot.ts
 M convex/schema.ts
 M src/app/api/assistant/chatbot/route.ts
 M src/app/pricing/page.tsx
?? .ralph/.tmp/prompt-20260212-173602-17364-2.md
?? .ralph/.tmp/story-20260212-173602-17364-2.json
?? .ralph/.tmp/story-20260212-173602-17364-2.md
?? .ralph/runs/run-20260212-173602-17364-iter-1.md
?? .ralph/runs/run-20260212-173602-17364-iter-2.log
?? convex/assistantToolAudits.ts
?? src/lib/assistant-tool-audit.ts
exec
/bin/zsh -lc 'git add -A' in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:

file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Clarifying git status output format**
exec
/bin/zsh -lc "git status --porcelain | sed -n '1,40p' | cat -vet" in /Users/macbook/Documents/GitHub/platform succeeded in 51ms:
M  .agents/tasks/prd-convex-composio-assistant.json$
A  .ralph/.tmp/prompt-20260212-173602-17364-2.md$
A  .ralph/.tmp/story-20260212-173602-17364-2.json$
A  .ralph/.tmp/story-20260212-173602-17364-2.md$
M  .ralph/activity.log$
M  .ralph/errors.log$
M  .ralph/runs/run-20260212-173602-17364-iter-1.log$
A  .ralph/runs/run-20260212-173602-17364-iter-1.md$
AM .ralph/runs/run-20260212-173602-17364-iter-2.log$
M  convex/_generated/api.d.ts$
M  convex/assistantComposioTools.ts$
A  convex/assistantToolAudits.ts$
M  convex/chatbot.ts$
M  convex/schema.ts$
M  src/app/api/assistant/chatbot/route.ts$
M  src/app/pricing/page.tsx$
A  src/lib/assistant-tool-audit.ts$
file update:
diff --git a/convex/assistantComposioTools.ts b/convex/assistantComposioTools.ts
index b407dafe5e710034fa0ec8f6624fb183a771166e..0587238c9aeb6a11e1d712c7b639d6ef9cb19bd7
--- a/convex/assistantComposioTools.ts
+++ b/convex/assistantComposioTools.ts
@@ -3,6 +3,7 @@
 import { Composio } from "@composio/core";
 import { v } from "convex/values";
 import OpenAI from "openai";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
 import {
 	buildCancellationMessage,
 	buildConfirmationRequiredMessage,
@@ -14,11 +15,16 @@
 import { action } from "./_generated/server";
 
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">,
+	memberId: Id<"members">
 ): Promise<{ success: boolean; response?: string; error?: string }> {
 	try {
 		if (!process.env.COMPOSIO_API_KEY) {
@@ -139,11 +145,78 @@
 
 			for (const toolCall of toolCalls) {
 				if (toolCall.type === "function") {
-					const actionParams = JSON.parse(toolCall.function.arguments);
-					await composio.tools.execute(toolCall.function.name, {
-						userId: entityId,
-						arguments: actionParams,
-					});
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
+					let actionParams: Record<string, unknown> | undefined;
+					try {
+						const parsed = JSON.parse(toolCall.function.arguments);
+						if (
+							parsed &&
+							typeof parsed === "object" &&
+							!Array.isArray(parsed)
+						) {
+							actionParams = parsed as Record<string, unknown>;
+						}
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error:
+									error instanceof Error
+										? error.message
+										: "Invalid tool call arguments",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
+
+					try {
+						await composio.tools.execute(toolCall.function.name, {
+							userId: entityId,
+							arguments: actionParams,
+						});
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+					} catch (error) {
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								userId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: error instanceof Error ? error.message : "Unknown error",
+								executionPath: "convex-assistant",
+								toolCallId: toolCall.id,
+							}
+						);
+						throw error;
+					}
 				}
 			}
 		}
@@ -184,7 +257,9 @@
 			`member_${memberId}`,
 			["GMAIL"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -205,7 +280,9 @@
 			`member_${memberId}`,
 			["SLACK"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -226,7 +303,9 @@
 			`member_${memberId}`,
 			["GITHUB"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -247,7 +326,9 @@
 			`member_${memberId}`,
 			["NOTION"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -268,7 +349,9 @@
 			`member_${memberId}`,
 			["CLICKUP"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
@@ -289,7 +372,9 @@
 			`member_${memberId}`,
 			["LINEAR"],
 			args.instruction,
-			args.workspaceId
+			args.workspaceId,
+			args.userId,
+			memberId
 		);
 	},
 });
diff --git a/convex/assistantToolAudits.ts b/convex/assistantToolAudits.ts
new file mode 100644
index 0000000000000000000000000000000000000000..21e110faed2a35e15b8f14f2e60b621ebcd689dc
--- /dev/null
+++ b/convex/assistantToolAudits.ts
@@ -0,0 +1,161 @@
+import { getAuthUserId } from "@convex-dev/auth/server";
+import { v } from "convex/values";
+import { sanitizeAuditPayload } from "../src/lib/assistant-tool-audit";
+import type { Id } from "./_generated/dataModel";
+import { internalMutation, mutation, query } from "./_generated/server";
+
+type ToolAuditOutcome = "success" | "error";
+
+async function getCurrentMember(
+	ctx: { db: any },
+	workspaceId: Id<"workspaces">,
+	userId: Id<"users">
+) {
+	return await ctx.db
+		.query("members")
+		.withIndex("by_workspace_id_user_id", (q: any) =>
+			q.eq("workspaceId", workspaceId).eq("userId", userId)
+		)
+		.unique();
+}
+
+const auditArgs = {
+	workspaceId: v.id("workspaces"),
+	memberId: v.optional(v.id("members")),
+	userId: v.optional(v.id("users")),
+	toolName: v.string(),
+	toolkit: v.optional(v.string()),
+	argumentsSnapshot: v.optional(v.any()),
+	outcome: v.union(v.literal("success"), v.literal("error")),
+	error: v.optional(v.string()),
+	executionPath: v.string(),
+	toolCallId: v.optional(v.string()),
+	timestamp: v.optional(v.number()),
+};
+
+function normalizeOutcome(value: ToolAuditOutcome): ToolAuditOutcome {
+	return value === "error" ? "error" : "success";
+}
+
+async function insertAuditEvent(
+	ctx: { db: any },
+	args: {
+		workspaceId: Id<"workspaces">;
+		memberId?: Id<"members">;
+		userId?: Id<"users">;
+		toolName: string;
+		toolkit?: string;
+		argumentsSnapshot?: unknown;
+		outcome: ToolAuditOutcome;
+		error?: string;
+		executionPath: string;
+		toolCallId?: string;
+		timestamp?: number;
+	}
+) {
+	const safeArguments = sanitizeAuditPayload(args.argumentsSnapshot);
+	const safeError = sanitizeAuditPayload(args.error);
+
+	await ctx.db.insert("assistantToolAuditEvents", {
+		workspaceId: args.workspaceId,
+		memberId: args.memberId,
+		userId: args.userId,
+		toolName: args.toolName,
+		toolkit: args.toolkit,
+		argumentsSnapshot: safeArguments,
+		outcome: normalizeOutcome(args.outcome),
+		error: typeof safeError === "string" ? safeError : undefined,
+		executionPath: args.executionPath,
+		toolCallId: args.toolCallId,
+		timestamp: args.timestamp ?? Date.now(),
+	});
+}
+
+export const logExternalToolAttemptInternal = internalMutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		await insertAuditEvent(ctx, args);
+	},
+});
+
+export const logExternalToolAttempt = mutation({
+	args: auditArgs,
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			throw new Error("Unauthorized");
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			throw new Error("Unauthorized");
+		}
+
+		await insertAuditEvent(ctx, {
+			...args,
+			userId: args.userId ?? authUserId,
+			memberId: args.memberId ?? member._id,
+		});
+	},
+});
+
+export const listByWorkspace = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const member = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!member) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_timestamp", (q: any) =>
+				q.eq("workspaceId", args.workspaceId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
+
+export const listByWorkspaceAndMember = query({
+	args: {
+		workspaceId: v.id("workspaces"),
+		memberId: v.id("members"),
+		limit: v.optional(v.number()),
+	},
+	handler: async (ctx, args) => {
+		const authUserId = await getAuthUserId(ctx);
+		if (!authUserId) {
+			return [];
+		}
+
+		const requester = await getCurrentMember(ctx, args.workspaceId, authUserId);
+		if (!requester) {
+			return [];
+		}
+
+		if (
+			requester._id !== args.memberId &&
+			requester.role !== "owner" &&
+			requester.role !== "admin"
+		) {
+			return [];
+		}
+
+		return await ctx.db
+			.query("assistantToolAuditEvents")
+			.withIndex("by_workspace_id_member_id", (q: any) =>
+				q.eq("workspaceId", args.workspaceId).eq("memberId", args.memberId)
+			)
+			.order("desc")
+			.take(args.limit ?? 50);
+	},
+});
diff --git a/convex/chatbot.ts b/convex/chatbot.ts
index b41cb9487015832d10b915e4f21901e9fb54d42c..242ba7640b4198c6eb2d0b5f7567b41da918e32d
--- a/convex/chatbot.ts
+++ b/convex/chatbot.ts
@@ -6,7 +6,8 @@
 import { generateText } from "ai";
 import { v } from "convex/values";
 import OpenAI from "openai";
-import { api } from "./_generated/api";
+import { parseAndSanitizeArguments } from "../src/lib/assistant-tool-audit";
+import { api, internal } from "./_generated/api";
 import type { Id, TableNames } from "./_generated/dataModel";
 import { action } from "./_generated/server";
 
@@ -388,11 +389,15 @@
  * Resolves auth config IDs from the member's connected accounts so tools.get uses valid authConfigIds.
  */
 async function executeComposioAction(
-	ctx: { runQuery: (query: any, args: any) => Promise<any> },
+	ctx: {
+		runQuery: (query: any, args: any) => Promise<any>;
+		runMutation: (mutation: any, args: any) => Promise<any>;
+	},
 	entityId: string,
 	appNames: string[],
 	message: string,
-	workspaceId: Id<"workspaces">
+	workspaceId: Id<"workspaces">,
+	memberId: Id<"members">
 ): Promise<{
 	success: boolean;
 	response?: string;
@@ -530,6 +535,9 @@
 		) {
 			for (const toolCall of completion.choices[0].message.tool_calls) {
 				if (toolCall.type === "function") {
+					const sanitizedArgs = parseAndSanitizeArguments(
+						toolCall.function.arguments
+					);
 					try {
 						const actionParams = JSON.parse(toolCall.function.arguments);
 						const result = await composio.tools.execute(
@@ -539,6 +547,19 @@
 								arguments: actionParams,
 							}
 						);
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "success",
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						toolResults.push({
 							toolCallId: toolCall.id,
@@ -553,6 +574,20 @@
 
 						const errorMessage =
 							error instanceof Error ? error.message : "Unknown error";
+						await ctx.runMutation(
+							internal.assistantToolAudits.logExternalToolAttemptInternal,
+							{
+								workspaceId,
+								memberId,
+								toolName: toolCall.function.name,
+								toolkit: appNames[0]?.toUpperCase(),
+								argumentsSnapshot: sanitizedArgs,
+								outcome: "error",
+								error: errorMessage,
+								executionPath: "convex-chatbot",
+								toolCallId: toolCall.id,
+							}
+						);
 
 						// Check if it's a connection error
 						if (
@@ -1592,7 +1627,8 @@
 				entityId,
 				appNames,
 				args.query,
-				workspaceId
+				workspaceId,
+				memberId
 			);
 
 			if (composioResult.success && composioResult.response) {
diff --git a/convex/schema.ts b/convex/schema.ts
index 098a15a7bed4cd5260de78be08702bf605f86def..a0957242440c438d698faacc94d4310279f837df
--- a/convex/schema.ts
+++ b/convex/schema.ts
@@ -478,6 +478,24 @@
 		.index("by_workspace_id_user_id", ["workspaceId", "userId"])
 		.index("by_conversation_id", ["conversationId"]),
 
+	assistantToolAuditEvents: defineTable({
+		workspaceId: v.id("workspaces"),
+		memberId: v.optional(v.id("members")),
+		userId: v.optional(v.id("users")),
+		toolName: v.string(),
+		toolkit: v.optional(v.string()),
+		argumentsSnapshot: v.optional(v.any()),
+		outcome: v.union(v.literal("success"), v.literal("error")),
+		error: v.optional(v.string()),
+		executionPath: v.string(),
+		toolCallId: v.optional(v.string()),
+		timestamp: v.number(),
+	})
+		.index("by_workspace_id", ["workspaceId"])
+		.index("by_member_id", ["memberId"])
+		.index("by_workspace_id_member_id", ["workspaceId", "memberId"])
+		.index("by_workspace_id_timestamp", ["workspaceId", "timestamp"]),
+
 	// Composio v3 Auth Configs (formerly integrations) - Now user-specific
 	auth_configs: defineTable({
 		workspaceId: v.id("workspaces"),
diff --git a/src/app/api/assistant/chatbot/route.ts b/src/app/api/assistant/chatbot/route.ts
index 7575c2d3ab45abe294e8dc07b91b0920d200da3b..ba636e7b5fabdc48e6c0b4eaa955431ed87ff202
--- a/src/app/api/assistant/chatbot/route.ts
+++ b/src/app/api/assistant/chatbot/route.ts
@@ -13,6 +13,7 @@
 	buildAssistantSystemPrompt,
 	classifyAssistantQuery,
 } from "@/lib/assistant-orchestration";
+import { parseAndSanitizeArguments } from "@/lib/assistant-tool-audit";
 import {
 	type AvailableApp,
 	createComposioClient,
@@ -58,6 +59,43 @@
 	});
 }
 
+async function logExternalToolAuditEvent(params: {
+	convex: ConvexHttpClient;
+	workspaceId: Id<"workspaces">;
+	memberId?: Id<"members">;
+	userId?: Id<"users">;
+	toolName: string;
+	toolkit?: string;
+	argumentsSnapshot: unknown;
+	outcome: "success" | "error";
+	error?: string;
+	executionPath: string;
+	toolCallId?: string;
+}) {
+	try {
+		await params.convex.mutation(
+			api.assistantToolAudits.logExternalToolAttempt,
+			{
+				workspaceId: params.workspaceId,
+				memberId: params.memberId,
+				userId: params.userId,
+				toolName: params.toolName,
+				toolkit: params.toolkit,
+				argumentsSnapshot: params.argumentsSnapshot,
+				outcome: params.outcome,
+				error: params.error,
+				executionPath: params.executionPath,
+				toolCallId: params.toolCallId,
+			}
+		);
+	} catch (error) {
+		console.warn(
+			"[Chatbot Assistant] Failed to persist tool audit event",
+			error
+		);
+	}
+}
+
 /**
  * Handle chatbot POST requests by routing the user's query through OpenAI+Composio tool integration when applicable, otherwise falling back to the Convex-based assistant.
  *
@@ -83,6 +121,7 @@
 export async function POST(req: NextRequest) {
 	try {
 		const convex = createConvexClient();
+		let authenticatedUserId: Id<"users"> | null = null;
 
 		// Pass auth through to Convex so membership/tasks/channels work.
 		// We attempt token retrieval even if isAuthenticatedNextjs() is false, because
@@ -140,6 +179,7 @@
 			if (!currentUser) {
 				return NextResponse.json({ error: "User not found" }, { status: 404 });
 			}
+			authenticatedUserId = currentUser._id;
 
 			// Get the member for this workspace and verify ownership
 			const member = await convex.query(api.members.getMemberById, {
@@ -368,6 +408,39 @@
 							resultMap[call.id] = toolResults[idx] ?? { success: true };
 						});
 
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								const toolResult = resultMap[call.id];
+								const outcome: "success" | "error" =
+									toolResult?.success === false || Boolean(toolResult?.error)
+										? "error"
+										: "success";
+
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome,
+									error:
+										outcome === "error"
+											? String(
+													toolResult?.error ||
+														toolResult?.message ||
+														"Tool execution failed"
+												)
+											: undefined,
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
+
 						// Log warning if counts differ
 						if (toolCalls.length !== toolResults.length) {
 							console.warn(
@@ -400,6 +473,28 @@
 							"[Chatbot Assistant] Tool execution failed:",
 							toolError
 						);
+						await Promise.all(
+							toolCalls.map(async (call) => {
+								await logExternalToolAuditEvent({
+									convex,
+									workspaceId: workspaceId as Id<"workspaces">,
+									memberId: memberId as Id<"members"> | undefined,
+									userId: authenticatedUserId ?? undefined,
+									toolName: call.function?.name || "unknown_tool",
+									toolkit: undefined,
+									argumentsSnapshot: parseAndSanitizeArguments(
+										call.function?.arguments || "{}"
+									),
+									outcome: "error",
+									error:
+										toolError instanceof Error
+											? toolError.message
+											: "Tool execution failed",
+									executionPath: "nextjs-openai-composio",
+									toolCallId: call.id,
+								});
+							})
+						);
 						responseText +=
 							"\n\nNote: Some operations could not be completed. Please try again or check your integration settings.";
 					}
diff --git a/src/lib/assistant-tool-audit.ts b/src/lib/assistant-tool-audit.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b4d1e63f1d6bb3fe7207244d290b08f9c10f931f
--- /dev/null
+++ b/src/lib/assistant-tool-audit.ts
@@ -0,0 +1,70 @@
+const REDACTED_VALUE = "[REDACTED]";
+const MAX_DEPTH = 6;
+const MAX_STRING_LENGTH = 2000;
+const SENSITIVE_KEY_PATTERN =
+	/(^|_|-)(token|secret|password|passphrase|api[_-]?key|authorization|cookie|credential|private[_-]?key|access[_-]?token|refresh[_-]?token|client[_-]?secret)(_|-|$)/i;
+
+function sanitizeString(input: string): string {
+	return input
+		.replace(/(Bearer\s+)[^\s]+/gi, `$1${REDACTED_VALUE}`)
+		.replace(
+			/(token|secret|password|api[_-]?key)\s*[:=]\s*["']?[^"',\s}]+/gi,
+			`$1=${REDACTED_VALUE}`
+		)
+		.slice(0, MAX_STRING_LENGTH);
+}
+
+export function sanitizeAuditPayload(
+	value: unknown,
+	depth = 0,
+	parentKey = ""
+): unknown {
+	if (depth > MAX_DEPTH) {
+		return "[TRUNCATED]";
+	}
+
+	if (value === null || value === undefined) {
+		return value;
+	}
+
+	if (SENSITIVE_KEY_PATTERN.test(parentKey)) {
+		return REDACTED_VALUE;
+	}
+
+	if (typeof value === "string") {
+		return sanitizeString(value);
+	}
+
+	if (
+		typeof value === "number" ||
+		typeof value === "boolean" ||
+		typeof value === "bigint"
+	) {
+		return value;
+	}
+
+	if (Array.isArray(value)) {
+		return value.map((item) =>
+			sanitizeAuditPayload(item, depth + 1, parentKey)
+		);
+	}
+
+	if (typeof value === "object") {
+		const entries = Object.entries(value as Record<string, unknown>);
+		const sanitized: Record<string, unknown> = {};
+		for (const [key, childValue] of entries) {
+			sanitized[key] = sanitizeAuditPayload(childValue, depth + 1, key);
+		}
+		return sanitized;
+	}
+
+	return String(value).slice(0, MAX_STRING_LENGTH);
+}
+
+export function parseAndSanitizeArguments(rawArguments: string): unknown {
+	try {
+		return sanitizeAuditPayload(JSON.parse(rawArguments));
+	} catch {
+		return sanitizeAuditPayload(rawArguments);
+	}
+}


thinking
**Ensuring clean commit with repeated staging**
